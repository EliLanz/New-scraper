#!/bin/bash
# GitHub Actions å¿«é€Ÿéƒ¨ç½²è„šæœ¬

set -e

echo "========================================"
echo "  GitHub Actions å¿«é€Ÿéƒ¨ç½²å‘å¯¼"
echo "========================================"
echo ""

# æ£€æŸ¥ Git
if ! command -v git &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªå®‰è£… Git"
    echo "è¯·å…ˆå®‰è£… Git: https://git-scm.com/downloads"
    exit 1
fi

echo "âœ… Git å·²å®‰è£…: $(git --version)"
echo ""

# æ­¥éª¤ 1: åˆå§‹åŒ– Git ä»“åº“
echo "========================================="
echo "æ­¥éª¤ 1: åˆå§‹åŒ– Git ä»“åº“"
echo "========================================="
echo ""

if [ -d ".git" ]; then
    echo "âš ï¸  Git ä»“åº“å·²å­˜åœ¨"
else
    git init
    echo "âœ… Git ä»“åº“åˆå§‹åŒ–å®Œæˆ"
fi

# åˆ›å»º .gitignore
if [ ! -f ".gitignore" ]; then
    echo "âš ï¸  .gitignore æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå·²è‡ªåŠ¨åˆ›å»º"
fi

echo ""

# æ­¥éª¤ 2: é…ç½® Git ç”¨æˆ·ä¿¡æ¯
echo "========================================="
echo "æ­¥éª¤ 2: é…ç½® Git ç”¨æˆ·ä¿¡æ¯"
echo "========================================="
echo ""

read -p "è¯·è¾“å…¥æ‚¨çš„ GitHub ç”¨æˆ·å: " github_username
read -p "è¯·è¾“å…¥æ‚¨çš„ GitHub é‚®ç®±: " github_email

git config user.name "$github_username"
git config user.email "$github_email"

echo "âœ… Git ç”¨æˆ·ä¿¡æ¯é…ç½®å®Œæˆ"
echo ""

# æ­¥éª¤ 3: æ·»åŠ è¿œç¨‹ä»“åº“
echo "========================================="
echo "æ­¥éª¤ 3: é…ç½®è¿œç¨‹ä»“åº“"
echo "========================================="
echo ""

read -p "è¯·è¾“å…¥æ‚¨çš„ GitHub ä»“åº“åç§° (ä¾‹å¦‚: news-scraper): " repo_name

remote_url="https://github.com/$github_username/$repo_name.git"

if git remote | grep -q "origin"; then
    echo "âš ï¸  è¿œç¨‹ä»“åº“ origin å·²å­˜åœ¨"
    read -p "æ˜¯å¦æ›´æ–°ä¸ºæ–°çš„åœ°å€? (y/n): " update_remote
    if [ "$update_remote" = "y" ]; then
        git remote set-url origin "$remote_url"
        echo "âœ… è¿œç¨‹ä»“åº“åœ°å€å·²æ›´æ–°"
    fi
else
    git remote add origin "$remote_url"
    echo "âœ… è¿œç¨‹ä»“åº“å·²æ·»åŠ : $remote_url"
fi

echo ""

# æ­¥éª¤ 4: æäº¤ä»£ç 
echo "========================================="
echo "æ­¥éª¤ 4: æäº¤ä»£ç "
echo "========================================="
echo ""

git add .
git status

echo ""
read -p "ç¡®è®¤æäº¤æ‰€æœ‰æ–‡ä»¶? (y/n): " confirm_commit

if [ "$confirm_commit" = "y" ]; then
    git commit -m "Initial commit: æ–°é—»æŠ“å–è‡ªåŠ¨åŒ–é¡¹ç›®"
    echo "âœ… ä»£ç æäº¤å®Œæˆ"
else
    echo "âš ï¸  è·³è¿‡æäº¤æ­¥éª¤"
fi

echo ""

# æ­¥éª¤ 5: æ¨é€åˆ° GitHub
echo "========================================="
echo "æ­¥éª¤ 5: æ¨é€åˆ° GitHub"
echo "========================================="
echo ""

echo "æç¤º: ç¡®ä¿æ‚¨å·²åœ¨ GitHub ä¸Šåˆ›å»ºäº†ä»“åº“"
echo "      ä»“åº“åœ°å€: https://github.com/$github_username/$repo_name"
echo ""

read -p "æ˜¯å¦ç°åœ¨æ¨é€ä»£ç åˆ° GitHub? (y/n): " confirm_push

if [ "$confirm_push" = "y" ]; then
    git branch -M main
    git push -u origin main
    echo "âœ… ä»£ç æ¨é€æˆåŠŸ!"
else
    echo "âš ï¸  è·³è¿‡æ¨é€æ­¥éª¤"
    echo "   ç¨åå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ: git push -u origin main"
fi

echo ""

# æ­¥éª¤ 6: é…ç½® Secrets æé†’
echo "========================================="
echo "æ­¥éª¤ 6: é…ç½® GitHub Secrets (é‡è¦!)"
echo "========================================="
echo ""

echo "ç°åœ¨éœ€è¦åœ¨ GitHub ä»“åº“ä¸­é…ç½® Secretsï¼š"
echo ""
echo "1. è®¿é—®: https://github.com/$github_username/$repo_name/settings/secrets/actions"
echo ""
echo "2. ç‚¹å‡» 'New repository secret' æ·»åŠ ä»¥ä¸‹ 4 ä¸ª secretsï¼š"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Secret 1: SENDER_EMAIL                          â”‚"
echo "   â”‚ Value: æ‚¨çš„å‘ä»¶é‚®ç®±åœ°å€                          â”‚"
echo "   â”‚ ä¾‹å¦‚: your_email@qq.com                         â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Secret 2: SENDER_PASSWORD                       â”‚"
echo "   â”‚ Value: é‚®ç®±æˆæƒç ï¼ˆä¸æ˜¯ç™»å½•å¯†ç ï¼ï¼‰              â”‚"
echo "   â”‚ ä¾‹å¦‚: abcd1234efgh5678                          â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Secret 3: RECIPIENTS                            â”‚"
echo "   â”‚ Value: JSON æ•°ç»„æ ¼å¼çš„æ”¶ä»¶äººåˆ—è¡¨                 â”‚"
echo "   â”‚ ä¾‹å¦‚: [\"user@example.com\"]                      â”‚"
echo "   â”‚ å¤šä¸ªæ”¶ä»¶äºº: [\"user1@a.com\", \"user2@b.com\"]    â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Secret 4: SMTP_TYPE                             â”‚"
echo "   â”‚ Value: é‚®ç®±ç±»å‹                                  â”‚"
echo "   â”‚ å¯é€‰: qq, gmail, 163, outlook                   â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

read -p "æŒ‰å›è½¦é”®ç»§ç»­..."

echo ""

# æ­¥éª¤ 7: æµ‹è¯•è¿è¡Œ
echo "========================================="
echo "æ­¥éª¤ 7: æµ‹è¯• GitHub Actions"
echo "========================================="
echo ""

echo "é…ç½®å®Œ Secrets åï¼š"
echo ""
echo "1. è®¿é—®: https://github.com/$github_username/$repo_name/actions"
echo ""
echo "2. é€‰æ‹© 'Daily News Scraper' workflow"
echo ""
echo "3. ç‚¹å‡» 'Run workflow' æŒ‰é’®è¿›è¡Œæµ‹è¯•"
echo ""
echo "4. æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æˆåŠŸ"
echo ""

# å®Œæˆ
echo "========================================="
echo "  ğŸ‰ éƒ¨ç½²å‘å¯¼å®Œæˆï¼"
echo "========================================="
echo ""
echo "ä¸‹ä¸€æ­¥:"
echo "  1. åœ¨ GitHub ä¸Šé…ç½® 4 ä¸ª Secrets"
echo "  2. æ‰‹åŠ¨è§¦å‘ workflow è¿›è¡Œæµ‹è¯•"
echo "  3. ç¡®è®¤é‚®ä»¶å‘é€æˆåŠŸ"
echo "  4. ç­‰å¾…æ¯å¤©è‡ªåŠ¨æ‰§è¡Œï¼ˆåŒ—äº¬æ—¶é—´ 8:00ï¼‰"
echo ""
echo "è¯¦ç»†æ–‡æ¡£:"
echo "  - GitHub Actions æŒ‡å—: GITHUB_ACTIONS_GUIDE.md"
echo "  - é¡¹ç›®è¯´æ˜: README.md"
echo ""
echo "å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£æˆ–æ£€æŸ¥ Actions æ—¥å¿—"
echo ""
